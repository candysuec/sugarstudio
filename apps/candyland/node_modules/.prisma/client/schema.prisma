generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String          @id @default(cuid())
  name           String?
  email          String?         @unique
  emailVerified  DateTime?
  image          String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime?       @updatedAt
  role           Role            @default(VIEWER)
  accounts       Account[]
  brands         Brand[]
  reports        Report[]
  safetyProfile  SafetyProfile?
  selfRepairLogs SelfRepairLog[]
  sessions       Session[]
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String   @id @default(cuid())
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Brand {
  id                     String   @id @default(cuid())
  name                   String
  description            String?
  mission                String?
  vision                 String?
  values                 Json?
  targetAudience         String?
  usp                    String?
  personalityTraits      Json?
  messagingMatrix        Json?
  postIdeas              Json?
  brandBook              String?
  toneGuide              String?
  contentPillars         Json?
  slogans                Json?
  colorPalettes          Json?
  logoIdeas              Json?
  generatedLogoImage     String?
  typographyPairings     Json?
  notionPageId           String?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  userId                 String
  messagingGuide         String?
  personaSheets          String?
  imageryAndArtDirection Json?
  pressKit               String?
  salesDeck              String?
  websiteCopy            String?
  user                   User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model SelfRepairLog {
  id        String   @id @default(cuid())
  timestamp DateTime @default(now())
  mode      String
  overall   String
  details   Json?
  userId    String?
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model SafetyProfile {
  id                String    @id @default(cuid())
  userId            String    @unique
  safetyScore       Int       @default(0)
  monitoredAccounts Json?
  lastScan          DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Report {
  id          String   @id @default(cuid())
  userId      String
  reportedUrl String
  category    String
  notes       String?
  status      String   @default("PENDING")
  resolution  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

enum UserRole {
  USER
  ADMIN
}

enum Role {
  ADMIN
  EDITOR
  VIEWER
}
